From df30aed7746cae8ba0480d2e78c0e5e340c7a18f Mon Sep 17 00:00:00 2001
From: Xabier Marquiegui <reibax@gmail.com>
Date: Fri, 11 Mar 2022 08:46:21 +0100
Subject: [PATCH 1/3] Add beautified versions of index.html and
 swupdate.rbxos.js

---
 examples/www/v2/index.rbxos.html     | 122 +++++++++++++++++++++++++
 examples/www/v2/js/swupdate.rbxos.js | 106 +++++++++++++++++++++
 2 files changed, 228 insertions(+)
 create mode 100755 examples/www/v2/index.rbxos.html
 create mode 100644 examples/www/v2/js/swupdate.rbxos.js

diff --git a/examples/www/v2/index.rbxos.html b/examples/www/v2/index.rbxos.html
new file mode 100755
index 0000000..c0dd348
--- /dev/null
+++ b/examples/www/v2/index.rbxos.html
@@ -0,0 +1,122 @@
+<!doctype html>
+<html lang="en">
+  <head>
+    <meta charset="utf-8">
+    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
+    <link rel="icon" href="images/favicon.png" type="image/png">
+    <link rel="stylesheet" href="css/bootstrap.min.css">
+    <link rel="stylesheet" href="css/dropzone.min.css">
+    <link rel="stylesheet" href="css/fontawesome.min.css">
+    <link rel="stylesheet" href="css/solid.min.css">
+    <link rel="stylesheet" href="css/swupdate.min.css">
+    <script src="js/jquery.min.js"></script>
+    <script src="js/bootstrap.min.js"></script>
+    <script src="js/dropzone.min.js"></script>
+    <script src="js/swupdate.min.js"></script>
+    <title>SWUpdate - Software Update for Embedded Systems</title>
+  </head>
+  <body>
+    <!-- Navigation Header -->
+    <nav class="navbar sticky-top navbar-expand-sm navbar-dark bg-primary">
+      <div class="container">
+        <a class="navbar-brand" href="#">
+          <img class="d-inline-block align-top" src="images/logo.png" alt="">
+        </a>
+        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
+          <span class="navbar-toggler-icon"></span>
+        </button>
+        <div class="collapse navbar-collapse" id="navbarText">
+          <ul class="navbar-nav ml-auto">
+            <li class="nav-item">
+              <a id="swu-restart" class="nav-link" href="#">
+                <i class="fas fa-sync"></i> Restart System </a>
+            </li>
+          </ul>
+        </div>
+      </div>
+    </nav>
+    <!-- Use Bootstrap Grid Container -->
+    <div class="container">
+      <!-- Header -->
+      <div class="jumbotron my-3">
+        <h1 class="display-4">
+          <span class="text-primary">SW</span>Update
+        </h1>
+        <p class="lead">Software update for embedded systems</p>
+        <p>Upload a software image below, or restart the system at the top right corner.</p>
+      </div>
+      <div class="row my-3">
+        <div class="col">
+          <div class="card">
+            <div class="card-header pb-0">
+              <h5>
+                <i class="fas fa-wrench"></i> Software Update
+              </h5>
+            </div>
+            <div class="card-body">
+              <!-- Dropzone Button for drag&drop files -->
+              <form class="dropzone border rounded mb-3" id="dropzone" action="./upload" method="post" enctype="multipart/form-data">
+                <div class="dz-default dz-message">
+                  <span class="dz-message">Click here, or drag and drop a software update image file to this area.</span>
+                </div>
+              </form>
+              <!-- Status -->
+              <div id="swu-idle" class="alert alert-secondary">
+                <i class="fas fa-info-circle"></i> Update not started.
+              </div>
+              <div id="swu-run" class="alert alert-warning" style="display: none;">
+                <i class="fas fa-exclamation-triangle"></i> Updating may take a few minutes, please don't turn off the power.
+              </div>
+              <div id="swu-success" class="alert alert-success" style="display: none;">
+                <i class="fas fa-check-circle"></i> Updated successfully.
+              </div>
+              <div id="swu-failure" class="alert alert-danger" style="display: none;">
+                <i class="fas fa-times-circle"></i> Update failed.
+              </div>
+              <div id="swu-done" class="alert alert-info" style="display: none;">
+                <i class="fas fa-sync"></i> Restarting system.
+              </div>
+              <!-- Progress -->
+              <i id="swu-progress-spinner" class="fas"></i>
+              <strong id="swu-progress-run" style="display: none;">Updating:</strong>
+              <span id="swu-progress-name"></span>
+              <span id="swu-progress-value" class="float-right"></span>
+              <div class="progress">
+                <div id="swu-progress-bar" class="progress-bar progress-bar-striped" role="progressbar"></div>
+              </div>
+            </div>
+          </div>
+        </div>
+      </div>
+      <!-- Messages -->
+      <div class="row my-3">
+        <div class="col">
+          <div class="card">
+            <div class="card-header" id="headingMessages">
+              <a class="h5 collapsed" data-toggle="collapse" href="#collapseMessages" aria-expanded="false" aria-controls="collapseMessages">
+                <i class="fas"></i> Messages </a>
+            </div>
+            <div id="collapseMessages" class="collapse" aria-labelledby="headingMessages">
+              <div class="card-body" id="messages"></div>
+            </div>
+          </div>
+        </div>
+      </div>
+      <!-- Restart -->
+      <div id="swu-restart-modal" class="modal fade" tabindex="-1" role="dialog">
+        <div class="modal-dialog modal-dialog-centered" role="document">
+          <div class="modal-content">
+            <div class="modal-body p-3 mb-2">
+              <div class="media">
+                <i class="fas fa-spinner fa-spin fa-3x align-self-center mr-3"></i>
+                <div class="media-body align-self-center">
+                  <h5 class="mt-0 mb-0">The system will restart. Please be patient, as restarting takes about one minute.</h5>
+                </div>
+              </div>
+            </div>
+          </div>
+        </div>
+      </div>
+    </div>
+  </body>undefined
+</html>
\ No newline at end of file
diff --git a/examples/www/v2/js/swupdate.rbxos.js b/examples/www/v2/js/swupdate.rbxos.js
new file mode 100644
index 0000000..35615df
--- /dev/null
+++ b/examples/www/v2/js/swupdate.rbxos.js
@@ -0,0 +1,106 @@
+/*!
+ * Copyright (C) 2017-2018 Weidm√ºller Interface GmbH & Co. KG
+ * Stefan Herbrechtsmeier <stefan.herbrechtsmeier@weidmueller.com>
+ *
+ * SPDX-License-Identifier: MIT
+ */
+function restart() {
+	$.post("restart", {}, function(s) {
+		showRestart()
+	})
+}
+
+function showRestart() {
+	$("#swu-restart-modal").modal({
+		backdrop: "static",
+		keyboard: !1
+	}), window.setTimeout(tryReload, 3e3)
+}
+
+function tryReload() {
+	$.ajax({
+		cache: !1,
+		timeout: 1e3,
+		success: function(s) {
+			window.location.reload(!0)
+		},
+		error: function(s, e, a) {
+			"timeout" === e ? tryReload() : window.setTimeout(tryReload, 1e3)
+		}
+	})
+}
+
+function updateStatus(s) {
+	switch ($("#swu-idle").hide(), $("#swu-success").hide(), $("#swu-failure").hide(), $("#swu-done").hide(), $("#swu-run").hide(), s) {
+		case "IDLE":
+			$("#swu-idle").show();
+			break;
+		case "START":
+		case "RUN":
+			$("#swu-run").show();
+			break;
+		case "SUCCESS":
+			$("#swu-success").show();
+			break;
+		case "FAILURE":
+			$("#swu-failure").show();
+			break;
+		case "DONE":
+			$("#swu-done").show()
+	}
+}
+var updateProgressBarStatus = function(s) {
+	var e = "";
+	return function(s) {
+		switch ($("#swu-progress-bar").removeClass("bg-danger bg-success progress-bar-animated"), $("#swu-progress-spinner").removeClass("fa-spinner fa-spin"), $("#swu-progress-run").hide(), s) {
+			case "START":
+				updateProgressBar(0, "", "");
+				break;
+			case "RUN":
+				$("#swu-progress-bar").addClass("progress-bar-animated"), $("#swu-progress-spinner").addClass("fa-spinner fa-spin"), $("#swu-progress-run").show();
+				break;
+			case "SUCCESS":
+				$("#swu-progress-bar").addClass("bg-success");
+				break;
+			case "FAILURE":
+				"START" === e && "RUN" === e || updateProgressBar(0, "", ""), $("#swu-progress-bar").addClass("bg-danger")
+		}
+		e = s
+	}
+}();
+
+function updateProgressBar(s, e, a) {
+	$("#swu-progress-value").text(a), $("#swu-progress-name").text(e), $("#swu-progress-bar").css("width", s + "%").attr("aria-valuenow", s)
+}
+Dropzone.options.dropzone = {
+	timeout: 0,
+	clickable: !0,
+	acceptedFiles: ".swu",
+	maxFilesize: 4096
+}, window.onload = function() {
+	var s;
+	$("#swu-restart").click(restart), s = "https:" === window.location.protocol ? "wss:" : "ws:";
+	var e = new WebSocket(s + "//" + window.location.host + window.location.pathname.replace(/\/[^\/]*$/, "") + "/ws");
+	e.onopen = function(s) {
+		updateStatus("IDLE")
+	}, e.onclose = function(s) {
+		showRestart()
+	}, e.onmessage = function(s) {
+		var e = JSON.parse(s.data);
+		switch (e.type) {
+			case "message":
+				var a = $("<p></p>");
+				a.text(e.text), a.addClass("mb-1"), e.level <= 3 && a.addClass("text-danger"), $("#messages").append(a);
+				break;
+			case "status":
+				updateStatus(e.status), updateProgressBarStatus(e.status);
+				break;
+			case "source":
+				break;
+			case "step":
+				var r = Math.round((100 * (Number(e.step) - 1) + Number(e.percent)) / Number(e.number)),
+					t = r + "% (" + e.step + " of " + e.number + ")";
+				updateProgressBar(r, e.name, t)
+		}
+	}
+};
\ No newline at end of file
-- 
2.25.1

